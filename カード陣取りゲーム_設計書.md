以下の設計書をよく読んで、内容を理解してください。
言語はお任せします、最適な言語を選んでください。そのうえで下記のゲーム制作をお願い致します。

---

# 1. ゲーム概要

* タイトル（仮）：**ForCard**
* 種類：

  * 2人対戦 / ターン制 / 同時プロット型
  * 陣取り＋カードゲーム
* 勝利条件：

  * ゲーム終了時の**総スコアが高いプレイヤーの勝ち**
* 特徴：

  * 各マスに「**安定度（Stability）**」という値があり、

    * 低い安定度で広く塗る
    * 高い安定度で要塞のように固める
  * どちらのスタイルでも戦えるよう、
    **エリア点＋堅牢ボーナス＋要塞ボーナス**でスコアを計算する。

---

# 2. 盤面・プレイヤー・カード

## 2.1 盤面

* サイズ：**5×5 の正方グリッド**（後から選択可能）

* 各マスが持つ情報：

  * `stability`（整数）…安定度。初期値 0。
  * 所有者：

    * `stability > 0`：プレイヤーAの色
    * `stability < 0`：プレイヤーBの色
    * `stability = 0`：無色（中立）

* 安定度の範囲：

  * **-5〜+5 にクリップ（上限・下限）**
  * 計算後に `min(max(stability, -5), 5)` を適用する。

## 2.2 プレイヤー

* プレイヤーは2人（仮に A / B）。
* 使用するカードセット：

  * **カードの種類・枚数は A / B 全く同じ**（対称性を確保）。
  * 1ゲームに使用するカード枚数：**15枚（後から選択可能）**
    （カード枚数＝ターン数、毎ターン1枚ずつ使用して全て使い切る想定）

※ 「全カードを最初から手札として持つ」
　現状のベース案としては、**両者が同一構成のカード15枚を持ち、1度使ったカードは再使用不可**。

## 2.3 カードの種類（概念レベル）

じゃあ、設計書の **2.3「カードの種類」**を完成版として書き直しますね。
（ここからコピペしても設計書として使えるようにしておきます）

---

## 2.3 カードの種類

### 2.3.1 カードの分類と共通ルール

本ゲームに登場するカードは、大きく **「色カード」** と **「強化カード」** と **「特殊カード」** の3種類に分かれる。

#### ■ 色カード（Color Cards）

- 置いたマスを基準としたパターンに対して、
  そのマス群の **安定度 `stability` を変化させる「塗り」系カード。**
- 主に、
  - 中立マスや敵色マスを「自分色」に近づけて新たに塗る
  - 既に自分色のマスもついでに強化する
- 自分視点で書くと：
  - 自分が塗るとき：対象マスの `stability` に **+n**
  - 相手が塗るとき：対象マスの `stability` に **-n**
- 効果適用後は、すべてのマスで `stability ∈ [-5, +5]` にクリップする。

#### ■ 強化カード（Fort Cards）

- すでに色が付いているマス（主に **自色マス**）の安定度を
  **まとめて強化・調整するカード群。**
- 特徴：
  - 新しくマスを自分色に「塗る」ことよりも、
    既に確保した陣地の安定度を底上げする役割が強い。
  - 多くは「自色マスのみ」「安定度が一定以下のマスのみ」など、
    **条件付きで強化**する。
- 強化カードのIDは **`Fxx`**（例：F01, F02, …）を用いる。

#### ■ 特殊カード（Special Cards）

- 安定度の変化に加え、
  - **ターン構造**
  - **要塞ボーナスの取りやすさ**
  - **相手のカードの無効化・コピー・読み合い**
- など、ゲームの「ルールそのもの」や「カード同士の駆け引き」を
  大きく動かすカード。
- 特殊カードのIDは **`Sxx`** を用いる。

#### ■ 共通仕様

- すべてのカードは **必ずどこか1マスに置く必要がある。**
- カードごとに「置けるマスの条件」が指定されている場合がある：
  - 条件を満たさない場合、そのカードは **原則プレイ不可（UI上も選択不可）**
  - ただし **「手札がそのカード1枚だけ」の場合**は、
    - プレイはできるが **完全不発（効果なし）** とする  
      （安定度・スコアは一切変化しない）

---

## 2.3.2 色カード一覧（塗り系 Color Cards：Cxx）

色カードには便宜的に **強さランク（★〜★★★）** を付ける。

以下の説明は「自分視点」で書く。相手が使うときは符号が逆になる。

---

### 【弱い色カード（★☆☆）】

#### C01：単点塗り（★☆☆）

- 任意のマス1つを対象に、そのマスの安定度を **+1**。

#### C03：直線2マス（★☆☆）

- ターゲットマスと、その **上下 or 左右どちらか一方の隣接マス** 計2マスを **+1**。

#### C04：斜め2マス（★☆☆）

- ターゲットマスと、その **斜め方向の隣接マス1つ** の計2マスを **+1**。

#### C06：角専用3マス（★☆☆）

- **盤面の四隅のいずれか**にのみ置ける。
- その角マス＋内向き2マス（例：右下なら (4,4),(3,4),(4,3)）を **+1**。

#### C07：端専用3マス（★☆☆）

- 盤面の**辺上（端）**のマスにのみ置ける。
- そのマス＋盤面内側方向の2マス（合計3マス）を **+1**。

#### C09：敵色削り（★☆☆）

- **敵色マス1つ**を選び、その安定度を +2（＝0側に2近づく）。  
  自色や中立マスは選んだ場合は安定度 +1

#### C10：上下2マス塗り（★☆☆）

- ターゲットの **上と下の2マス** を **+1**。ターゲット自身は変化なし。

---

### 【そこそこの色カード（★★☆）】

#### C11：十字塗り（★★☆）

- ターゲット＋上下左右（最大5マス）を **+1**。

#### C12：斜め十字塗り（★★☆）

- ターゲット＋斜め4マス（最大5マス）を **+1**。

#### C13：横三連（★★☆）

- ターゲットの **左・中心・右**（最大3マス）を **+1**。

#### C14：縦三連（★★☆）

- ターゲットの **上・中心・下**（最大3マス）を **+1**。

#### C15：2×2ブロック塗り（★★☆）

- ターゲットを **左上**とみなした 2×2 ブロック4マスを **+1**。

#### C16：L字形成（★★☆）

- ターゲット＋右＋下（計3マス）を **+1**。  
- 配置時に向きを選べる（90度単位で回転可）。

#### C17：T字形成（★★☆）

- ターゲット＋左右＋上 **または** 下（計3〜4マス）を **+1**。  
- 上向きT／下向きT を選んで使用。

---

### 【強い色カード（★★★）】

#### C21：横一列塗り（★★★）

- 任意の **行（横一列）** の全マスを **+1**。

#### C22：縦一列塗り（★★★）

- 任意の **列（縦一列）** の全マスを **+1**。

#### C24：3×3ブロック塗り（★★★）

- 任意の **3×3 ブロック内の全マス**を **+1**。

---

## 2.3.3 強化カード一覧（Fort Cards：Fxx）

ここでは、既に塗られているマス（主に自色マス）の安定度を  
**強化・調整することを主目的とするカード**をまとめる。  
強化カードのIDは **F01〜F13** を用いる。

---

### 【弱めの強化カード / サポート寄り（★☆☆〜★★☆）】

#### F01：単点強化（★☆☆）

- 自色マス1つ（`stability > 0`）を選び、その安定度を **+2**。

#### F02：周囲自陣集中塗り（自陣ブースト）（★☆☆）

- ターゲット＋上下左右 計5マスのうち、  
  **自色マスだけを +1**（中立・敵色は変化なし）。

#### F03：中心＋自陣強化（★☆☆）

- ターゲット＋上下左右 計5マスのうち、  
  **自色マスのみ +1**。ターゲットが敵色でも、自色でなければ変化なし。

---

### 【中堅クラスの強化カード（★★☆）】

#### F04：L字強化（自陣のみ）（★★☆）

- 任意の 2×2 ブロックを指定し、  
  その中の **自色マスだけ安定度 +2**。

#### F05：十字強化（自陣のみ）（★★☆）

- ターゲット＋上下左右のうち、  
  **自色マスだけ +1**。

#### F06：周囲自陣強化（中心自色限定）（★★☆）

- ターゲットは **自色マスのみ**。
- ターゲット＋上下左右のうち、**自色マスだけ +1**。

---

### 【強力な強化カード（★★★）】

#### F07：2×2集中強化（★★★）

- 任意の **2×2 ブロック**内の **自色マスのみ** の安定度を **+2**。

#### F08：全自陣ブースト（★★★）

- 盤面上の **自色マスすべて** の安定度を **+1**。

#### F09：全自陣超強化＋反動（★★★）

- 自色マスすべて **+2**。  
- さらに敵色マスすべて **+1**（＝0側に1だけ近づく）。  
  ※自陣強化と同時に、敵陣も少しだけ揺らす高リスクカード。

#### F10：行要塞化（★★★）

- 任意の行を1つ選び、その行の **自色マスだけ** 安定度 **+2**。

#### F11：列要塞化（★★★）

- 任意の列を1つ選び、その列の **自色マスだけ** 安定度 **+2**。

#### F12：連結領域強化（★★★）

- 任意の **自色連結領域（4方向連結）** を1つ選び、  
  その領域内の全マス安定度を **+1**。

#### F13：連結領域の弱点補強（★★★）

- 任意の自色連結領域1つを選び、  
  その領域内の **安定度 ≦ 2 の自色マスだけ** 安定度 **+2**。

---

## 2.3.4 特殊カード一覧（最終採用10枚：Sxx）

特殊カードは以下の10枚を採用する：

- S01：リバーサル・フィールド（Reversal Field）
- S02：フォーカスシフト（Focus Shift）
- S03：オーバーロード（Overload）
- S04：ダブルアクション（Double Play）
- S05：スペシャルジャマー（Special Jammer）
- S06：カラーギャンブル（Color Gamble）
- S07：タイムボム（Time Bomb）
- S08：サクリファイス・スワップ（Sacrifice Swap）
- S09：ラストフォートレス（Last Fortress）
- S10：ターゲットロック（Target Lock）

### ■ 共通ルール（特殊カード）

- すべて **1マスに置く必要がある**（そのマスが効果の基準になるものが多い）。
- 各カードごとに「置けるマスの条件」がある場合、
  条件を満たさないと **原則プレイ不可**。  
  ただし、**手札がそのカード1枚だけ**の場合は「プレイ可だが完全不発」。

---

### S01：リバーサル・フィールド（Reversal Field）

**効果：**

- 使用時点の「ターン開始時の盤面」を記録しておき、  
  有効ターン内ならその盤面に対して **安定度の符号を一括反転** する。
  - `stability ≠ 0` の全マスについて
    - `+s → -s`
    - `-s → +s`
    - `0 は変化なし`
- その後、通常通り 色カードフェーズ → 特殊カードフェーズ を処理。

**有効ターン制限：**

- **全ターン数 - 3**
  - カードの残り枚数が3枚より多い間は有効となる

- 【例】全15ターン制の場合：
  - **ラウンド1〜12** で使った場合：上記の「全反転」効果。
  - **ラウンド13〜15** で使った場合：  
    → 効果は **C01：単点塗り** と同じになる（任意マス1つを +1）。

---

### S02：フォーカスシフト（Focus Shift）

**前提条件：**

- 直前の自分のターンに、**色カードを1枚使用していること**。
  - 直前ターンで特殊カードしか使っていない場合：
    - 原則プレイ不可
    - ただし手札が S02 のみの場合は不発で終了。

**効果：**

- 直前の自分ターンで使った **色カードと同じパターン** を、  
  このターンに **S02 を置いたマスを中心**としてもう一度適用する。
- 振る舞いとしては「“直前の色カード”をもう一度使える色カード」とみなす。

---

### S03：オーバーロード（Overload）

**配置条件：**

- **自色マスにのみ置ける。**

**効果：**

1. 置いたマスの安定度を **+5（上限5でクリップ）** に設定する。
2. そのマスの **上下左右4マス** の安定度を、それぞれ **-1** する  
   （結果として中立や敵色になる可能性あり）。

**イメージ：**

- 「一点を猛烈な要塞にする代わりに、周囲がひび割れる」タイプのカード。

---

### S04：ダブルアクション（Double Play）

**基本効果：**

- このカードを使った **「次の自分ターンに限り」**、
  - 手札から **色カードを最大2枚まで連続でプレイ**できる。
  - その次の自分ターンは **行動スキップ**（カードを出せない）。

- **次ターンに2回使えるカードは「色カードのみ」。**  
  特殊カードはダブルアクションの対象外。
- S04 をプレイした時点で、  
  「S04 を除く残り手札の **色カードが1枚以下**」の場合：
  - 本来のダブルアクション効果は **発動不可** と判定。
  - このとき S04 は **C01：単点塗りとしてその場で処理**し、  
    次ターンの追加行動／スキップ効果は **一切発生しない**。

---

### S05：スペシャルジャマー（Special Jammer）

**効果：**

- このターン、相手が出したカードが **特殊カード** だった場合：
  - 相手のその特殊カードの効果を **完全に無効化**（そのターン何もしなかった扱い）。
  - 自分側には追加効果なし（完全カウンター）。

- 一方、相手が **色カードもしくは強化カード** を出していた場合：
  - 自分の S05 は **完全に空振り**。
  - ペナルティとして：
    - 自色マス（`stability > 0`）からランダムに **3マス** 選び、  
      それぞれ安定度を **-1** する。

- **両者とも同じターンに S05 を出した場合：**
  - お互い「相手の特殊を無効化しようとしたが外した」扱いとし、  
    双方ともペナルティ（自陣ランダム3マス -1）のみ発生。

---

### S06：カラーギャンブル（Color Gamble）

**コンセプト：**

- 「このターン、相手は **色カード** を出してくる」と読むカード。

**効果フロー（相手が色カードの場合）：**

1. 相手の色カードの
   - パターン P と
   - 相手が指定した中心マス C_op  
     による対象集合 **Ao** を計算する。
2. 自分の S06 は、自分が指定した中心マス C_you を基準に、  
   **同じパターン P** を適用して対象集合 **As** を計算する。
3. **相手から1マス奪う：**
   - Ao から1マス **c_steal** を選ぶ（ランダム／プレイヤー選択は要検討）。
   - c_steal については
     - 相手カードの塗り効果を **適用しない**
     - **自分色として +1** を適用する
4. 安定度更新：
   - 自分側：As 内の各マスに **+1**（c_steal も含めるが、二重加算はしない）。
   - 相手側：Ao から c_steal を取り除いた集合 Ao' にのみ **+1**（相手色）。
   - その後、全マスを `[-5, +5]` にクリップ。

→ 元のパターンが Nマスなら、

- 相手は最大 **N-1マス** 塗れる  
- 自分は最大 **Nマス** 塗れる＋1マス奪い  

という「読めば得する」構造。

**相手が特殊カードだった場合（読み外れ）：**

- 自分の S06 は **完全不発**。
- ペナルティ：
  - 自色マスからランダム **3マス** の安定度を **-1**。

---

### S07：タイムボム（Time Bomb）

**配置条件：**

- 盤面上のどのマスにも置ける（自色・敵色・中立問わず）。
- 置いたマスを **中心** とした 3×3 ブロックを「爆心地」としてマークする  
  （UI上で可視化）。

**効果：**

- 設置から **2ターン後の自分ターン終了時** に爆発が発生。
- 爆発時点の盤面に対して：
  - 爆心地3×3内の
    - 自色マス：安定度 **+2**
    - 敵色マス：安定度 **+1**（＝0側に寄る）
    - 中立マス：変化なし

→ 事前に「ここを自陣で固めておけば一気に要塞化できる」カード。  
相手は **爆心地から逃げる／形を崩す** ことで、価値を減らせる。

---

### S08：サクリファイス・スワップ（Sacrifice Swap）

**配置条件：**

- **中立マス or 敵色マスにのみ置ける**（自色マスには置けない）。

**効果フロー：**

1. カードを置いたターンの終了時点の盤面で、  
   自色マスから **最大3マスまで「犠牲マス」を指定**する。
2. 色カードフェーズ後の盤面を見て、  
   指定した犠牲マスのうち **まだ自色のまま** のマスについて、
   - それぞれの `|stability|` を合計し、合計値を **S_total** とする。
   - 色が敵色や中立になってしまったマスは **S_totalに加算しない**。
   - 対象となった犠牲マスは全て **安定度0（中立）** にリセット。
3. S_total の配分：
   - まず、**カードを置いたマス**に S_total を一括加算（上限 +5）。
   - 5を超えた分は、そのマスの **上下左右 → さらにその外側…** の順に、  
     あらかじめ決めたルールで **+1 ずつ振り分ける**。
   - いずれのマスも +5 を超えないようにし、振り分け切れなかった分は切り捨て。

→ 「自陣の一部からパワーを吸い上げて前線に叩きつける」カード。  
そのターンの相手の色カード次第で **犠牲マスが削られ、S_total が減るリスク**がある。

---

### S09：ラストフォートレス（Last Fortress）

**配置と対象領域の選択：**

- カードを置いたマスが属する **自色連結領域（4方向連結）** を1つ自動的に対象とする。
- UI上で「このカードを置くと、この領域が対象になる」ことをハイライト表示する。

**効果は残りターン数で2モード：**

#### ■ 残り4ターン以上で使用した場合（早期使用）

- 対象連結領域の全マスの中からランダムに **1〜3マス** を選び、  
  それぞれの安定度を **+1** する。
- このとき、対象連結領域およびそれ以外の自色マスは、  
  **相手の色カード／特殊カードの影響を通常どおり受ける（バリアなし）**。  
  → ただの「要塞育成カード」として使えるが、相手に崩されるリスクもある。

#### ■ 残り3ターン以内で使用した場合（覚醒状態）

- このカードを使用した **そのターン中**、  
  対象連結領域内の各マスは **相手の色カードによる安定度変化を一切受けない**  
  （塗り／削りともに無効。自分の色カードによる変化は有効）。
- ターン終了時に、対象連結領域について次を行う：
  - 対象連結領域内の **自色マスの安定度をすべて 2倍** にする（上限 +5 でクリップ）。
  - 対象連結領域「以外」の自色マスは、すべて **安定度0（中立）** にリセットされる。

→ 終盤になると「1つの要塞に全てを賭ける」オールインカードに変貌する。  
残り3ターンになったタイミングで、カードの演出を変えて「覚醒」を示すと分かりやすい。

---

### S10：ターゲットロック（Target Lock）

**配置条件：**

- 相手がこのターン **色カードを使う**と読んで、  
  「相手が中心にしそうなマス」に自分のカードを置く（＝そのマスをロック座標とする）。

**効果：**

- 色カードフェーズで相手の色カードの対象マス集合を確定させたあと、
  - もし相手の色カードの対象に **ロック座標が含まれていれば**：
    - そのマスに対する相手の塗りは **無効化**。
    - 代わりに、そのマスの安定度を **自分色として +2**（上限 +5）。
  - 含まれていなかった場合（読み外れ）：
    - ロック座標が
      - 自色マス：安定度 **-2**
      - 中立マス：安定度 **-1**（＝敵側に1だけ傾く）
      - 敵色マス：安定度 **+1**（＝相手が得する）

→ 「このマスを狙ってくるだろ」を一点読みする、非常にピーキーなカード。


---


# 3. 用語定義

## 3.1 安定度（Stability）

* 各マスが「そのプレイヤーの色としてどれだけ強く支配されているか」を表す整数。
* 表示：

  * 所有プレイヤーの色でマスを塗り、
  * **|stability| が大きいほど色を濃く描画**して視覚的に表現。

## 3.2 連結領域

* 同じプレイヤーの色が付いたマス同士で、

  * **上下左右（4方向）でつながっている部分集合**を「1つの連結領域」と定義する。
* 斜めのみで接している場合は別領域とみなす。

## 3.3 要塞形（フォートレス・パターン）

要塞ボーナス計算で使用する「形」のパターン。
1つの連結領域の中で、以下の形が「完全に同一プレイヤーのマス」で構成される場合、その領域に要塞ボーナス候補が発生する。

* **2×2**
* **L字（2×2 のうち3マス）**
* **十字（中心＋上下左右の5マス）**

※ 2×3, 3×3 などの拡張パターンは、後続の拡張ルールとして追加可能。

---

# 4. ゲームの流れ

## 4.1 セットアップ

1. 盤面を初期化する：

   * 5×5 の全マスの `stability = 0`（無色）。
2. 各プレイヤーに、

   * 同一構成のカード15枚を配る（手札）。
3. 先手・後手を決める（ゲーム進行上は**同時プロット**なので、
   先手/後手は「表記上の区別」程度）。

## 4.2 1ターンの進行

1. **カード選択フェーズ（同時秘密選択）**

   * 各プレイヤーは、自分の未使用カードから1枚選び、
   * そのカードを置く**ターゲットマス（座標）**を1つ指定する。（どのカードでも、必ずどこかのマスに置かなければならない）
   * この時点では、相手から

     * どのカードを選んだか
     * どのマスを指定したか
       は見えない。

2. **公開フェーズ**

   * 両プレイヤーが選択を確定したら、
     **同時にカード内容と指定マスを公開**する。

3. **解決フェーズ**

   * 公開された2枚のカードの効果を盤面に適用する。
   * 適用順ルール（基本）：

     1. 色カードの「安定度変化」をすべての対象マスに対して同時適用

        * プレイヤーA：対象マスの `stability += 効果値（例：+1）`
        * プレイヤーB：対象マスの `stability -= 効果値`
        * そのターン内で、両者の効果は**足し合わせてから**判定
        * 適用後に各マスを **-5〜+5でクリップ**
     2. 特殊カードがある場合は、カードごとの定義順に解決
        （必要なら「この効果は色塗りより先/後」といった優先度をカード側に持たせる）
   * このターンの処理が終了した時点で盤面が更新される。

4. **ターン終了**

   * 使用したカードは「使用済み」扱いにして再利用不可。
   * 次のターンに進む。

## 4.3 ゲーム終了

* **15ターン経過**し、
  お互いのカード（15枚）をすべて使用し終わったらゲーム終了。
* その時点の盤面を使って、
  **スコア計算 → 勝敗判定**を行う。

※ 拡張として「早期終了条件（例：残りターン数的に逆転不可能）」を入れることは可能だが、
　基本ルールでは**15ターン固定**で統一する。

---

# 5. 安定度の更新ルール（カード効果）

## 5.1 基本ルール

* 色カードは、
  「ターゲットマスを中心とした**相対座標の集合**」を持つ。

* 解決時：

  * 各対象マス `(x, y)` について

    * プレイヤーAが置いたカード：`stability[x, y] += k`
    * プレイヤーBが置いたカード：`stability[x, y] -= k`
    * （k はカードごとに定義。基本例では k = 1）

* 両プレイヤーのカードによる変化は **同時に合算** される。

* その後、各マスに対して：

  * `stability[x, y] = min( max(stability[x, y], -5), 5 )`

## 5.2 配置可能マス

* どのマスにもカードを置いてよい：

  * 無色マス
  * 自分色マス
  * 相手色マス
* 同じマスを何度ターゲットにしてもよい（制限なし）。

→ これにより、

* 自分の陣地を**さらに固める**
* 相手の陣地を**削って奪う**
* 無色マスを**新規に取りに行く**

という選択肢が毎ターン生まれる。

---

# 6. スコアリング仕様

最終スコアは、

> **基本エリアスコア + 堅牢ボーナス + 要塞ボーナス**

の合計で決定する。
（内部的には**小数回避のため全て整数スケールで管理**）

以下、説明は人間が理解しやすいよう「概念」と「内部実装スケール」に分けて書きます。

---

## 6.1 概念レベル（説明用）

### ① 基本エリアスコア

* 自分の色になっているマス **1マスにつき 1点**

### ② 堅牢ボーナス（マス単位）

* 自色マスの **安定度 |s| に応じて**、以下のボーナスを追加：

| |s| | 堅牢ボーナス |
|-----|-----------|
| 1   | +0.0      |
| 2   | +0.5      |
| 3   | +1.0      |
| 4   | +1.5      |
| 5   | +2.0      |

* そのマスの「エリアスコア + 堅牢ボーナス」を合計する。

### ③ 要塞ボーナス（連結領域＋形単位）

1. 自分の色のマスだけを対象に、4方向連結で**連結領域**をすべて抽出。

2. 各連結領域ごとに、その領域内から以下の「要塞形」を列挙：

   * 2×2
   * L字（2×2 のうち任意の3マス）
   * 十字（中心＋上下左右の5マス）

3. 各要塞形について：

   * その形の**全マスの安定度が 2以上**のときのみ「要塞候補」とする。
   * その形の中での **最小安定度 = m** とし、基礎ボーナスを以下のように決める：

     | 最小安定度 m | 要塞ボーナス |
     | ------- | ------ |
     | 2       | +1     |
     | 3       | +2     |
     | 4       | +3     |
     | 5       | +4     |

4. 同じ連結領域内の要塞候補が複数あるとき：

   * 各候補の基礎ボーナスを**大きい順に並べる**。
   * 一番大きいもの：**そのまま全額加算**。
   * 2つ目以降のもの：**基礎ボーナスの 1/2 点だけ加算**。

5. 全連結領域の要塞ボーナスを合計し、
   「基本エリアスコア＋堅牢ボーナス」に加算する。

### ④ 同点時の扱い

* 両プレイヤーの総スコアが同点の場合：

  * 基本ルール：**引き分け**
  * 拡張案として

    * 「要塞数が多い方の勝ち」
    * 「安定度の合計が大きい方の勝ち」
      などのタイブレークも設定可能（今は未採用でOK）。

---

## 6.2 内部実装スケール（×2 スコア）

実装では **小数を使わないためにスコアを2倍**して管理する。

* 基本エリアスコア：

  * 自色マス1マスにつき **2点**（概念上の1点×2）
* 堅牢ボーナス：

| |s| | 概念ボーナス | 内部スコア |
|-----|-------------|-----------|
| 1   | +0.0        | +0        |
| 2   | +0.5        | +1        |
| 3   | +1.0        | +2        |
| 4   | +1.5        | +3        |
| 5   | +2.0        | +4        |

* 要塞ボーナス（基礎）：

| 最小安定度 m | 概念ボーナス | 内部スコア |
| ------- | ------ | ----- |
| 2       | +1     | +2    |
| 3       | +2     | +4    |
| 4       | +3     | +6    |
| 5       | +4     | +8    |

* 同じ連結領域内で2つ目以降の要塞候補：

  * 内部スコアを **半分（整数割り）**
    （例：+3 → +1 or +2 など、四捨五入 or 切り捨ては仕様で決める）

UI上も「内部スコア（整数）」をそのまま表示してしまってよい。
（もし「1点単位」で見せたければ、最終表示時だけ `/2` してもOK）

---

# 7. 拡張・調整の余地（メモ）

この設計をベースに、今後調整・追加できるポイント：

* **カード設計**

  * 色カード：パターン・範囲・安定度の増減値
  * 特殊カード：

    * 特定マスの安定度を一気に上げる／下げる
    * 要塞形だけを強化／破壊
    * 次ターンの要塞ボーナスを2倍にする 等
* **ターン数／盤サイズ**

  * 5×5・15ターンは「基本ルール」
  * 6×6・20ターンなどのロングゲームモードも将来的に追加可
* **要塞形の追加**

  * 2×3 / 3×2 / 3×3 など大型のカタマリを
    上級ルールとして追加し、さらに奥行きを出すこともできる。

---

このあたりを「v1仕様」として固めておけば、
あとは

* カードの具体的な一覧
* UIワイヤーフレーム
* 実装クラス設計（`Cell`, `Board`, `Card`, `Player`, `GameManager` など）

を生やすだけで、かなりしっかりした設計書になります。

次は「カードの具体例を10〜15種類くらい出して、どれが広く薄く寄り・狭く濃く寄り・要塞寄りか」をラベル付きで整理してみましょうか？

- S01：リバーサル・フィールド（Reversal Field）
  - 仕様は最新版
- S07 フォーカスシフト（Focus Shift）
- S08 オーバーロード（Overload）
- S09 ダブルアクション（Double Play）
- S11：スペシャルジャマー（Special Jammer）
- S12：カラーギャンブル（Color Gamble）
  - 仕様は最新版
- S13：タイムボム（Time Bomb）
- S14：サクリファイス・スワップ（Sacrifice Swap）
- S15：ラストフォートレス（Last Fortress）
- S16：ターゲットロック（Target Lock）


## 現状の改善点
- ターン数によって効果が変わるカード（S01：リバーサル・フィールド（Reversal Field）やS15：ラストフォートレス（Last Fortress））は効果が切り替わるまでのターン数を表示させる

S01：リバーサル・フィールド（Reversal Field）ややS04：ダブルアクション（Double Play）が**C01：単点塗り**と同じに変わった場合は、カードの説明もC01：単点塗りと同じにする

使用できない場合特殊カードの処理

## ワンクリック起動機能（実装済み）

商用展開を考慮し、ワンクリックでゲームを起動できる機能を実装しました。

### 実装内容

- **Windows用**: `起動.bat` - ダブルクリックで起動
- **macOS用**: `起動.command` - ダブルクリックで起動
- **Linux用**: `起動.sh` - ターミナルから実行

### 機能

1. Node.jsのインストール確認
2. 依存関係の自動インストール（初回のみ）
3. 自動ビルド
4. サーバー起動とブラウザの自動オープン

### 使用方法

- Windows: `起動.bat` をダブルクリック
- macOS: `起動.command` をダブルクリック
- Linux: `chmod +x 起動.sh && ./起動.sh`

これにより、技術的な知識がないユーザーでも簡単にゲームを起動できます。



